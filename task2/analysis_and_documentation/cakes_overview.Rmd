---
title: "Cake Ingredient Analysis"
output: html_notebook
---

```{r}
library(tidyverse)
library(readr)
library(janitor)
library(skimr)
library(stringr)
library(here)
```


```{r}
# Read in the data
cake_recipes <- read_csv(here("data/raw_data/cake-ingredients-1961.csv"))
cake_codes <- read_csv(here("data/raw_data/cake_ingredient_code.csv"))
```

# Cake Ingredient Analysis

## The Raw Data

The *raw data* came in the form of two .csv files. Table 1 (cake_ingredients_1961.csv)  contains all the different types of cake with all of the `ingredient codes` as column headers. This file was in __wide format__ and filled with **NA values**. Table 2 (cake_ingredient_code) contains a list of ingredients and their correspongding `ingredient code`, as well as a measure column. The only thing missing from this table was the `measure` value for "Sour cream cup".

### Additional Data for Further Analysis

It would be useful to have additional ingredient data for dietary requirements, such as gluten free, dairy free (see extra analysis), sugar free etc. This way I could easily calculate if each cake was suitable for people with dietary needs.

## Assumptions

My first assumption was that I would have to change the format of Table 1 to __long format__. This would make it easier to see which ingredients were required for each cake. I could see there were many __NA values__ in this table and I was assuming that these ingredients were not required for the corresponding cake, as oppose to *missing information*. The brief states that the full ingredient name is required and not just the `ingredient code`. So I thought the best way to approach this is to **join** the tables using the `ingredient code`. 

Another assumption I made about table 2 was that the *missing information* in the `measure` column was meant to be "cup". I assumed that the `ingredient` listed was meant to be "Sour cream" and the `measure` was meant to be "cup". Rather than the ingredient being "Sour cream cup".


## Cleaning Proceess Overview

1. My first step was to pivot the table in to __long format__. I chose to do this rather than clean the column headers as I knew that it would be easier keeping them in upper-case to join the tables.

2. I then decided that was the best time to get rid of __NA values__ so i used __drop_na()__
```{r}
cake_recipes_long <- cake_recipes %>%
     pivot_longer(cols = ("AE":"ZH"),
                names_to = "code",
                values_to = "quantity")

cake_recipes_dropna <- cake_recipes_long %>%
  drop_na(quantity)
cake_recipes_dropna
```


3. Now seemed like the time to `join` the tables, clean the header names and select only the columns I required (get rid of the _ingredient code_).
```{r}
 cake_recipes_full <- cake_recipes_dropna %>%
  left_join(cake_codes, by = "code")

cake_recipes_full_clean <- cake_recipes_full %>%
  clean_names()

cake_recipe_clean <- cake_recipes_full_clean %>%
  select(cake, ingredient, measure, quantity)
cake_recipe_clean
```


4. The last step in my cleaning process was dealing with the *missing information*. This was in the `measure` column corresponding to "Sour cream cup". As previously mentioned I removed the "cup" from the `ingredient` column and added it to the `measure` column.
```{r}
cake_recipe_clean_sour <- cake_recipe_clean %>%
  mutate(measure = coalesce(measure, "cup")) %>% 
  mutate(ingredient = str_remove(ingredient, " cup"))

cake_recipe_ingredients_lower <- cake_recipe_clean_sour %>% 
  mutate(ingredient = str_to_lower(ingredient))

cakes_cleaned <- cake_recipe_ingredients_lower
```

## Task Analysis

- Read in cleaned data
```{r}
cakes <- read_csv(here("data/clean_data/cakes_clean.csv"))
```

___1. Which cake has the most cocoa in it?___

- The `One Bowl Chocolate` cake has the most `Cocoa` in it.
```{r}
most_cocoa_cake <- cakes %>%
  filter(ingredient == "Cocoa") %>%
  slice_max(quantity)
most_cocoa_cake
```


___2. For sponge cake, how many cups of ingredients are used in total?___

- Filtered by _Sponge_ and _cup_ and then find the total of those values, which gives us 3.5 cups.
```{r}
sponge_cake_test <- cakes %>% 
  filter(cake == "Sponge",
         measure == "cup") %>% 
  summarise(total_quantity = sum(quantity))
sponge_cake_test
```


___3. How many ingredients are measured in teaspoons?___

- Filter by _teaspoon_ and use the **distinct()** function to find all of the individual ingredients that are measured in teaspoons.
```{r}
n_in_teaspoons <- cakes %>% 
  filter(measure == "teaspoon") %>% 
  distinct(ingredient) %>% 
  summarise(n_ingredients_teaspoon = n())
n_in_teaspoons
```

___4. Which cake has the most unique ingredients?___

- On finding the sum of the ingredients for each cake I discovered that both the `Babas au Rhum` and `One Bowl Chocolate` both contained 11 ingredients. Which was the highest number of ingredients of all of the cakes.
```{r}
most_unique_ingred <- cakes %>% 
  group_by(cake) %>% 
  summarise(total_no_ingred = n()) %>% 
  arrange(desc(total_no_ingred)) %>% 
  head(2)
most_unique_ingred
```

___5. Which ingredients are used only once?___

- **Grouped by** ingredients and then counted how many times each one occurs. I then filtered to show all of the ingredients which occured only once.
```{r}
ingredients_once <- cakes %>% 
  group_by(ingredient) %>% 
  mutate(times_used = n()) %>% 
  filter(times_used == 1) %>% 
  select(ingredient, times_used)
ingredients_once
```

## Extra Analysis

- Here I have created a `logical` column stating wether or not the ingredient contains dairy. I have then used this to find out which of the cakes are __dairy free__.
```{r}
cakes_contains_dairy <- cakes %>% 
  mutate(contains_dairy = case_when(
    ingredient == "butter" ~ TRUE,
    ingredient == "milk" ~ TRUE,
    ingredient == "chocolate" ~ TRUE,
    ingredient == "cottage cheese" ~ TRUE,
    ingredient == "sour cream" ~ TRUE,
    ingredient == "heavy cream" ~ TRUE,
    TRUE ~ FALSE))

cake_dairy_free <- cakes_contains_dairy %>% 
  group_by(cake) %>%
  summarise(n_ingredients_containing_dairy = sum(contains_dairy)) %>% 
  filter(n_ingredients_containing_dairy == 0)
cake_dairy_free
```

